language: generic
sudo: required
services:
- docker
addons:
  apt:
    packages:
    - jq
    - pv
before_install:
- openssl aes-256-cbc -K $encrypted_8de9452a1cf9_key -iv $encrypted_8de9452a1cf9_iv
  -in etc/deploy/ssh/id_ed25519.pittmesh.net.travis.enc -out $SSH_IDENTITY_FILE -d
  && chmod 600 $SSH_IDENTITY_FILE
install:
- cat etc/deploy/ssh/known_hosts >> $HOME/.ssh/known_hosts
- gem install html-proofer
- sudo apt-add-repository ppa:duggan/jo --yes && sudo apt-get update -q --yes && sudo
  apt-get install jo --yes
- 'scripts/notify.sh "${TRAVIS_REPO_SLUG} ${TRAVIS_BUILD_NUMBER}: [${TRAVIS_COMMIT_MESSAGE}]: ${TRAVIS_EVENT_TYPE} build underway"'
script:
- scripts/cibuild
- 'scripts/notify.sh "${TRAVIS_REPO_SLUG} ${TRAVIS_BUILD_NUMBER}: $( if [[ ${TRAVIS_TEST_RESULT} -eq 1 ]]; then echo ":x:"; else echo ":white_check_mark:"; fi )"'
env:
  global:
  - NOKOGIRI_USE_SYSTEM_LIBRARIES=true
  - SSH_IDENTITY_FILE=$HOME/.ssh/id_ed25519.pittmesh.net.travis
  - secure: MSLouby/SGSPip9wVROz/KB5ZHGCpcm7a4v4JN5HrJggxZPcajHXJQB0F14Wtxj6+uKdoO9geKteFuXiz2V8jQjibWPUfdY0RlTLc7q5DkX1lgp6tF9SI9/nb9Toe7w+A1vbdiJt8J1E9CDBzSF21wr4pjFaxYHjBYG7D5oc9AGvb6peWXJw14psstanyMlL5PCJkGiRaCI5mp3jOqPdKuSy9+NzqRSLOUa7W4RNX1hOKj8HQaOEvOt2WALfwnEXYvp3XkuSVKb9ZXBoorJIBHNs1eaHyKW1n3ZPbRT7em3rM5hD6X2IIBIc0kvBYlUGsIFJ7BBvQdgBrYNmkInwo6lb4p4gY7g6JfrLUNk+IWD4WUpWy/Znb1ohAVn14rX+lLWCMN0O6j9XrqtM3sigx8ck4K9m71StnURcKWGuSjGCzU/olQxWwnLfm/5ut3ia+LHqYYSBEXy99sybAKWoXSsKFTRXrZRQaNgX08z5duVDPsStrDSKtqxmcrrnf4uEAenvLHuQAShUPBUxwnz9qAXDUALJAgl+U5lbp7g/40ILGv7O0E+ebzmQU6CvtuFydvH4WoVHxKOxKAtO0/EbhGoQcOFVHJC3ZamGEuMXZaEjRzhBRSuncUphrCFcjOQ4rTvpY7KkIYEiRwZyL5msCTNZ3ADtBs6QDjl1QAvzwYo=
  - secure: ZlD6QieQnfCu1dWdlvj/upIbKD0wXXzqyICfNy/fTh6P6sTEPOVYEJlEb+4EGFigZadZFOgjwrYAtFfTBfVE6eNo013srS7cXyWVvAnThY5kYjrsio69mZAejg3d2pBX2Zyh8CJZ7SpVG44trgb+grw/+QDHQMT4QFB56/8dSxV5pOFfad1E8+3kclJOjxBvABdkWI64vctg7s8APpsNeQymjSE1i6dtVSSSr47nR41j3mLcyzvQSZ7szOaxUs432eVUS+k9oJGsOWiRWjHytUBw1ECZtmakZNkE7Lg30cscvOXqCShofcHYrRMQQOb/v8Gx8TI1J7AfWvT9p3iBuht712BK3mMz5eLENG4I9j4fD0t5g84XAkdCDwD2IjNLq1njMousXaZqxNK3ECHewDT/yHcxOxc5KoRHVI6usjCRKYKTF8EiW5K3apmh3Cr+8fuDcdfzAcXg+dc5jnACJhTWeAFJIvyVp2kd6N4AAdepYU1UOyRzy9gfL+E7yDHrrlvscx2ViiCU9ThGYnTK7+6Fp7/xno+0M+MiHchsruAosm8YCyLPk3lax6XzDZgBZ/LhW3GGBGnfgesmjWXRmHlVWwTFaccoWuxCzHXgiRUYS5Mim797Q1dvFkXf6rctqdlO4Q3A67leQhmO3SCE7AGJeRbSFz4frgjtRcKLN7g=
  - secure: U3mO46dOFHlrKzP5riSfcf/Yfeo0xcmjOCcC5146rYVougphGVsAIm6vMDMi0AgbxBaEuVW6CPDV6Lhb3ArfvhIoIyWiEhlJYTbySUwSU29zfHCDTfappLjin7/DqU6owwcM7nFUaQM9sKRDfM1cYp8YOij64EfBimuHBr74f6JCjwBHKHWR419lC5K67tyR0fmE9DlhXe5MPQ8CCEhYpbFkv95ZavhQiY01ibol7QtslZQka6lo8f7mTcffdpywi9BGq3ReSAplf1+NLcUV/kz3oNRRliyqhtq4irKQlo0t5L/FBBsEUMP/kmNYhNCM1y5qwXTyjUmESukOFd7wp9hUbu3Z09N2oF3FcFuutE32xlnpJQiSEk+zSaw+gKD6au+YPhIebLe1f/x6eQv+lqJVJqbDwEg44a0UGsGT3FSa7+IvtjZHg4JdHUd//bWwyUKJqykN1mw0dJGPx6CO3zheBfvXpqHF8gLfb0ydcLucYxc5Hu07N3gqLPCsqWCheeJbs00Qct5pA9QQeaRdsfELcVjtWfgaVnOHpLit9NjhyeyTRRmR8G40WeSr2CUD0WivUI/yzC3USaiDERy9BzZ2TO72PfIloReehYqRP8KaCxdxDSxEAMoeQyhZ3IAAi+xwqeUdNFK/QN2u/HgDtzYz3eAS5t3GZA2bWSyUHbA=
  - secure: G5rv7o+RYP4+3u2OcySO6GyOhJnK/0XZyixvaUa7BsEeHtAlPqmjzrglvK7ljqrcBN/ZtHDTz/PGfefJx/hCYCnofG03+QlKSxUqAkZYOHCFwu2FRpV9x+wmPO1l73wDrLkOEXd4WF25jO8hDWBcLcxaw3OmAu+ac4I6jW4puKbIKJOU1EkjDwpBzhzKgI79ZjhDyWYsC4WQ/FjKVyuZv9yIDFDwdUbBJJJaqiRZ/QgMKbmnYUZ2nLPoYsHjkPiqM4j86VfZj6lQ74kUGJpMi0VEq1n+LBqHdynKM+lkJkCKyA4Xga+pXBYG9DWmBd1EL3GREDP6o4So4Y7S9250My3tkqUBHEt1/T5qMxS/ghQMkR9K3El8bn+ujeCR0sajAAfYGOJONHFR3hLBnBjNEq/3r4IdsceEPLnVj1KSTpFy/a8EUV5dTj3lkDFT+1gAnc+fWlp9zGBIoBeQtRS+PO8gVV2hBcJ88/BdvPTaeTHLPw6K4FOdI8qRw4DrHXzv+ZZamEuwY/92U1bKJxzwNYLu6p91vw/eM4OLE+fT9pg5mMWxfi8IrizvgKhQk09oKtAWP6ziIB4vqnjbEtIyycFq7+o/mFBHMpy6IPTUVgSWAPFpR6XZz5JjvjpFac0l+OTNLOJKx5/Jp1QS9X+xBAogB5F0+C456oPSUlFPtHE=
deploy:
- provider: script
  skip_cleanup: true
  script: scripts/deploy.sh && scripts/notify.sh "${TRAVIS_REPO_SLUG} deployed, check https://pittmesh.net!"
  on:
    branch:
    - master
